
on:
  push:
    tags:
      - 'v*'
      
name: v2 Create Release and save notes to file 

jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
        - name: Run a one-line script
          run: echo Hello, world!

  create-github-release:
    name: Create GitHub Release
    runs-on: ubuntu-latest
    needs: publish
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      - name: Create Release
        run: |
          gh release create ${{ github.ref }} --generate-notes
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          
          
  get-release-notes:
    name: Get automatically created release notes
    runs-on: ubuntu-latest
    needs: create-github-release
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
        with:
          ref: main
        
      - name: Obtain notes and save to file
        run: |
          echo "hello again!"
          echo ""
          gh api -H "Accept: application/vnd.github+json" /repos/anna-follestad-4ss/auto-release/releases/latest -q ".body" > docs/new_notes.txt
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          
      - name: Setup Git
        run: |
          git config user.name 'anna-follestad-4ss'
          git config user.email 'anna.fehn.follestad@4subsea.com'
        
      - name: Push latest version
        run: |
          git add .
          git commit -m "saved release notes from latest release to file "
          git push origin main
          
 
 
  write:   
    runs-on: windows-latest 
    needs: get-release-notes
    
    steps:
      - name: Check out source
        uses: actions/checkout@v3
        with:
          ref: main

      - name: third text adder
        id: add_more_text
        run: |
          chdir docs
          type release_notes.rst >> new_notes.txt
          type new_notes.txt > release_notes.rst
  
  
      - name: Setup Git
        run: |
          git config user.name 'anna-follestad-4ss'
          git config user.email 'anna.fehn.follestad@4subsea.com'
        
      - name: Push latest version
        run: |
          git add docs/release_notes.rst
          git commit -m "added some text to release notes"
          git push origin main
          
          

        
